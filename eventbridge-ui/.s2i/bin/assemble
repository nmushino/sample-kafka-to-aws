#!/bin/bash
set -e

# 必要な public ディレクトリを作成
mkdir -p /opt/app-root/src/public

# .env から public/env.js を作る
cat <<EOF > /opt/app-root/src/public/env.js
window._env_ = {
  REACT_APP_AWS_REGION: "${REACT_APP_AWS_REGION}",
  REACT_APP_EVENT_BUS_NAME: "${REACT_APP_EVENT_BUS_NAME}",
  REACT_APP_AWS_ACCESS_KEY_ID: "${REACT_APP_AWS_ACCESS_KEY_ID}",
  REACT_APP_AWS_SECRET_ACCESS_KEY: "${REACT_APP_AWS_SECRET_ACCESS_KEY}"
};
EOF

# 既存の assemble を呼び出す（ubi8/nodejs イメージの既定のやつ）
exec /usr/libexec/s2i/assemble